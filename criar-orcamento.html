<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OptCar - Criar Or√ßamento</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Gerar or√ßamento de aluguer de ve√≠culos" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="OptCar" />
  <meta name="msapplication-TileColor" content="#ffffff" />

  <!-- PWA Icons -->
  <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="img/Icon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="img/Icon-16x16.png" />
  <link rel="apple-touch-icon" href="img/Icon-180x180.png" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <link rel="stylesheet" href="css/styles.css" />

  <style>
    label {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-top">
      <a href="index.html">
        <img 
          style="max-width: 150px;" 
          src="./img/Group 1.png" 
          alt="OptCar - Gest√£o de Aluguer de Ve√≠culos"
        />
      </a>

      <div class="online" aria-hidden="true"></div>
      <button
        id="theme-toggle"
        class="btn theme-btn"
        aria-label="Alternar tema"
      >
        <span class="theme-icon">üåô</span>
      </button>
    </div>
    <nav class="nav" aria-label="Navega√ß√£o principal">
      <a href="dashboard.html" class="btn">Dashboard</a>
      <a href="criar-orcamento.html" class="btn">Novo Or√ßamento</a>
      <a href="novo-aluguer.html" class="btn">Novo Aluguer</a>
      <a href="veiculos.html" class="btn">Ve√≠culos</a>
      <a href="historico.html" class="btn">Em Vigor</a>
      <a href="terminados.html" class="btn">Terminados</a>
      <a href="logout.html" class="btn danger">Logout</a>
    </nav>
  </header>

  <main class="container">
    <section class="card form-grid" id="orcamentoForm">
      <h1>Criar Or√ßamento</h1>
      <p class="quote"><strong>Nota:</strong> preenche os dados para gerar um or√ßamento em PDF.</p>

      <section aria-labelledby="clienteSection">
        <h2 id="clienteSection">Cliente</h2>
        <div class="grid-3">
          <div class="input-group">
            <label for="cliNome"><span data-required="true">Nome</span></label>
            <input 
              type="text" 
              id="cliNome" 
              required 
              style="text-transform: capitalize;"
              placeholder="Nome completo do cliente"
              aria-required="true"
              aria-describedby="cliNome-error"
            />
            <div class="error-message" id="cliNome-error" hidden></div>
          </div>
          <!-- <div class="input-group">
            <label for="cliNif"><span data-required="false">NIF</span></label>
            <input 
              type="text" 
              id="cliNif" 
              maxlength="9" 
              pattern="[0-9]{9}"
              aria-describedby="cliNif-error"
            />
            <div class="error-message" id="cliNif-error" hidden></div>
          </div> -->
          <div class="input-group">
            <label for="cliContacto"><span>Contacto</span></label>
            <input 
              type="tel" 
              id="cliContacto" 
              pattern="[0-9+\s-]{9,}"
              placeholder="+351 123 456 789"
              aria-describedby="cliContacto-error"
            />
            <div class="error-message" id="cliContacto-error" hidden></div>
          </div>
          <div class="input-group">
            <label for="cliEmail"><span>Email</span></label>
            <input 
              type="email" 
              id="cliEmail"
              placeholder="cliente@exemplo.com"
              aria-describedby="cliEmail-error"
            />
            <div class="error-message" id="cliEmail-error" hidden></div>
          </div>
        </div>
        <div class="grid-2">
          <!-- <div class="input-group full">
            <label for="cliMorada"><span>Morada</span></label>
            <textarea 
              id="cliMorada" 
              rows="2" 
              style="text-transform: capitalize;"
              aria-describedby="cliMorada-error"
            ></textarea>
            <div class="error-message" id="cliMorada-error" hidden></div>
          </div> -->
        </div>
      </section>

      <section aria-labelledby="veiculoSection">
        <h2 id="veiculoSection">Ve√≠culo</h2>
        <div class="grid-2">
          <div class="input-group full">
            <label for="selVeiculo">
              <span data-required="true">Ve√≠culo (stock)</span>
            </label>
            <select 
              id="selVeiculo" 
              required
              aria-required="true"
              aria-describedby="selVeiculo-error"
            >
              <option value="">Seleciona um ve√≠culo do stock‚Ä¶</option>
            </select>
            <div class="error-message" id="selVeiculo-error" hidden></div>
          </div>
          <div class="form-actions" style="align-self: end; margin: 0">
            <a href="veiculos.html" class="btn">Gerir ve√≠culos</a>
          </div>
        </div>
        <div id="veiculoCard" class="card" style="padding: 12px; margin: 8px 0; display:none">
          <strong id="vTitulo"></strong>
          <div id="vLinha1" class="muted" style="margin-top:4px"></div>
          <div id="vLinha2" class="muted" style="margin-top:2px"></div>
        </div>
      </section>

      <section aria-labelledby="condicoesSection">
        <h2 id="condicoesSection">Condi√ß√µes econ√≥micas</h2>
        <div class="grid-2">
          <div class="input-group">
            <label for="orcInicio"><span data-required="true">In√≠cio</span></label>
            <input 
              type="date" 
              id="orcInicio" 
              required
              min=""
              aria-required="true"
              aria-describedby="orcInicio-error"
            />
            <div class="error-message" id="orcInicio-error" hidden></div>
          </div>
          <div class="input-group">
            <label for="orcFim"><span data-required="true">Fim</span></label>
            <input 
              type="date" 
              id="orcFim" 
              required
              aria-required="true"
              aria-describedby="orcFim-error"
            />
            <div class="error-message" id="orcFim-error" hidden></div>
          </div>
        </div>
        <div class="info-card">
          <strong>Dura√ß√£o:</strong> <span id="lblDias" class="muted">‚Äî</span> dias
        </div>
        <div class="grid-3">
          <div class="input-group">
            <label for="orcPrecoDiario"><span data-required="true">Pre√ßo di√°rio (‚Ç¨)</span></label>
            <input 
              type="number" 
              id="orcPrecoDiario" 
              min="0.01" 
              step="0.01" 
              required
              aria-required="true"
              aria-describedby="orcPrecoDiario-error"
              placeholder="0.00"
            />
            <div class="error-message" id="orcPrecoDiario-error" hidden></div>
          </div>
          <div class="input-group">
            <label for="orcExtras"><span>Extras (‚Ç¨)</span></label>
            <input 
              type="number" 
              id="orcExtras" 
              min="0" 
              step="0.01" 
              value="0"
              placeholder="0.00"
              aria-describedby="orcExtras-error"
            />
            <div class="error-message" id="orcExtras-error" hidden></div>
          </div>
          <div class="input-group">
            <label for="orcDesconto"><span>Desconto (‚Ç¨)</span></label>
            <input 
              type="number" 
              id="orcDesconto" 
              min="0" 
              step="0.01" 
              value="0"
              placeholder="0.00"
              aria-describedby="orcDesconto-error"
            />
            <div class="error-message" id="orcDesconto-error" hidden></div>
          </div>
        </div>
        <div class="grid-3">
          <div class="input-group">
            <label for="orcCaucao"><span>Cau√ß√£o (‚Ç¨)</span></label>
            <input 
              type="number" 
              id="orcCaucao" 
              min="0" 
              step="0.01"
              placeholder="0.00"
              aria-describedby="orcCaucao-error"
            />
            <div class="error-message" id="orcCaucao-error" hidden></div>
          </div>
          <div class="input-group full">
            <label for="orcObs"><span>Observa√ß√µes</span></label>
            <textarea 
              id="orcObs" 
              rows="2"
              placeholder="Observa√ß√µes adicionais..."
              aria-describedby="orcObs-error"
            ></textarea>
            <div class="error-message" id="orcObs-error" hidden></div>
          </div>
        </div>
      </section>

      <div class="info-card total-info">
        <div><strong>Subtotal:</strong> <span id="lblSubtotal" class="muted">‚Äî</span></div>
        <div><strong>Total:</strong> <span id="lblTotal" class="muted">‚Äî</span></div>
        <div class="muted">(Total = Pre√ßo di√°rio √ó Dias + Extras ‚àí Desconto)</div>
      </div>

      <div class="form-actions">
        <button type="button" id="btnGerar" class="btn primary">Gerar PDF</button>
        <button type="button" id="btnValidar" class="btn">Validar Formul√°rio</button>
        <p id="msg" class="info" hidden aria-live="polite"></p>
      </div>
    </section>
    <div class="ar"></div>
  </main>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav" aria-label="Navega√ß√£o m√≥vel">
    <a href="dashboard.html" class="mobile-nav-item">
      <div class="mobile-nav-icon">
        <img src="./img/icons/dashboard-1-filled.svg" alt="Dashboard" />
      </div>
      <div class="mobile-nav-label">Dashboard</div>
    </a>
    <a href="criar-orcamento.html" class="mobile-nav-item active">
      <div class="mobile-nav-icon">
        <img src="./img/icons/writing.png" alt="Novo Or√ßamento" />
      </div>
      <div class="mobile-nav-label">Or√ß.</div>
    </a>
    <a href="novo-aluguer.html" class="mobile-nav-item">
      <div class="mobile-nav-icon">
        <img src="./img/icons/add-ring-fill.svg" alt="Novo Aluguer" />
      </div>
      <div class="mobile-nav-label">Novo Al.</div>
    </a>
    <a href="veiculos.html" class="mobile-nav-item">
      <div class="mobile-nav-icon">
        <img src="./img/icons/car.svg" alt="Ve√≠culos" />
      </div>
      <div class="mobile-nav-label">Ve√≠culos</div>
    </a>
    <a href="historico.html" class="mobile-nav-item">
      <div class="mobile-nav-icon">
        <img src="./img/icons/loading-three(1).svg" alt="Alugueres em vigor" />
      </div>
      <div class="mobile-nav-label">Em Vigor</div>
    </a>
    <a href="terminados.html" class="mobile-nav-item">
      <div class="mobile-nav-icon">
        <img src="./img/icons/done2-filled.svg" alt="Alugueres terminados" />
      </div>
      <div class="mobile-nav-label">Terminados</div>
    </a>
  </nav>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- App Scripts -->
  <script src="js/firebase.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/contract.js"></script>
  <script src="js/orcamento.js"></script>
  <script src="js/criarOrcamento.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/loading.js"></script>
  <script src="js/pwa.js"></script>
  
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      protectPage();
      
      // Definir data m√≠nima para hoje
      const hoje = new Date().toISOString().split('T')[0];
      const inputInicio = document.getElementById('orcInicio');
      if (inputInicio) {
        inputInicio.min = hoje;
      }
      
      const waiters = [new Promise((r)=>setTimeout(r,400))];
      window.loading?.when(waiters).then(() => window.dispatchEvent(new Event('page-ready')));
    });
  </script>
</body>
</html> 